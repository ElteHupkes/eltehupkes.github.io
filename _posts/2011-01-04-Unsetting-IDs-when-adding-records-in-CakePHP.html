---
layout: post
title: "Unsetting ID's when adding records in CakePHP"
date: 2011-01-04
background: '/images/cover.jpg'
tags: cakephp
---

        <div class="paragraph">
<p>Say you are the regular Cake-guy and you&#8217;re running a straightforward blog with a "Post" model with a linked "Comment"
model where your viewers can reply. Your code to save a comment probably looks something like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-php" data-lang="php">if (!empty($this-&gt;data)) {
	// Some CAPTCHA / other security checks
	// A fieldList is always a good idea
	$fieldList = array('name', 'email', 'comment', 'post_id');

	$this-&gt;Comment-&gt;create();
	if (!$this-&gt;Comment-&gt;save($this-&gt;data, true, $fieldList)) {
		// Error handling
	} else {
		// Yay
	}
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Seems good right? Now say there&#8217;s a little code chimpansee looking to mess with your site.
He looks in the source code, sees the structure, and figures "hey, let&#8217;s just add an id field, see what happens".
He adds the <code>data[Comment][id]</code> field to the form and submits the comment the regular way. Now what happens is that,
<em>even though "id" is not in the fieldList</em>, it is gonna overwrite the comment with the supplied ID instead of generating
a new one. That could be nasty if a spammer decided to overwrite all your legitimate comments with his viagra ones.</p>
</div>
<div class="paragraph">
<p>If you are using <a href="http://api.cakephp.org/2.3/class-SecurityComponent.html">SecurityComponent</a>
this most likely won&#8217;t be a problem since the request will get blackholed.
Most simple blogs, I reckon, don&#8217;t have this though (oh, I do, by the way) so it&#8217;s something worth keeping in mind.
Especially since it&#8217;s so easy to solve, just add:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-php" data-lang="php">unset($this-&gt;data['Comment']['id']);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Above the <code>save()</code> call and the problem goes away. Another option is passing the data to <code>create()</code> and using
<code>true</code> as the second argument; this will filter any primary key present. Hope it helps somebody out there!</p>
</div>

